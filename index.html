<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wavewin Admin Panel - Complete Fixed System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .admin-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #e60000, #ff3333);
            transition: all 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(230, 0, 0, 0.3);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            transition: all 0.3s;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }
        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            transition: all 0.3s;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(81, 207, 102, 0.3);
        }
        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }
        .status-approved {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-rejected {
            background-color: #fecaca;
            color: #991b1b;
        }
        .status-completed {
            background-color: #d1fae5;
            color: #065f46;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .sidebar {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            transition: transform 0.3s ease;
        }
        .sidebar-mobile {
            transform: translateX(-100%);
        }
        .sidebar-mobile.open {
            transform: translateX(0);
        }
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .nav-item.active {
            background: linear-gradient(135deg, #e60000, #ff3333);
            color: white;
        }
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid #e60000;
            backdrop-filter: blur(10px);
        }
        .game-control-card {
            background: linear-gradient(135deg, rgba(230, 0, 0, 0.1), rgba(255, 51, 51, 0.1));
            border: 2px solid #e60000;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .gradient-text {
            background: linear-gradient(135deg, #e60000, #ff3333);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .main-content {
            transition: margin-left 0.3s ease;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                z-index: 50;
                width: 100%;
                max-width: 280px;
            }
            .main-content {
                margin-left: 0 !important;
            }
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }
        .overlay.show {
            display: block;
        }
        .bet-type-red {
            background: linear-gradient(135deg, #e60000, #ff3333);
            color: white;
        }
        .bet-type-green {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .bet-type-violet {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        .bet-type-number {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        .bet-type-size {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        .realtime-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
            animation: pulse 2s infinite;
        }
        .transaction-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            border-left: 4px solid #10b981;
        }
        .withdrawal-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border-left: 4px solid #ef4444;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Real-time Indicator -->
    <div class="realtime-indicator">
        <i class="fas fa-wifi mr-2"></i>
        <span>Real-time Sync Active</span>
    </div>

    <!-- Notification -->
    <div id="notification" class="fixed top-4 right-4 z-50 hidden">
        <div class="notification">
            <div id="notificationContent" class="px-6 py-3 rounded-lg shadow-lg">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="notificationText">Success!</span>
            </div>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="overlay"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl border-2 border-red-600 max-w-md w-full">
            <div class="text-center mb-8">
                <i class="fas fa-shield-alt text-6xl text-red-500 mb-4"></i>
                <h1 class="text-3xl font-bold gradient-text">WAVEWIN</h1>
                <p class="text-gray-400">Admin Panel Access</p>
                <div class="mt-4 text-sm text-gray-500">
                    Default Admin: 9934406008 / admin123
                </div>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                    <input type="text" id="adminPhone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter admin phone" value="9934406008">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="adminPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none text-white" placeholder="Enter admin password" value="admin123">
                </div>
                
                <div id="loginError" class="text-red-400 text-sm hidden">
                    <i class="fas fa-exclamation-circle mr-2"></i>
                    <span>Invalid credentials</span>
                </div>
                
                <button id="loginBtn" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Login to Admin Panel
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="flex min-h-screen hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar w-64 p-6 fixed h-full sidebar-mobile md:relative md:transform-none">
            <div class="text-center mb-8">
                <i class="fas fa-water text-4xl text-red-500 mb-2"></i>
                <h2 class="text-xl font-bold gradient-text">WAVEWIN ADMIN</h2>
                <div class="text-xs text-gray-400 mt-2">
                    <i class="fas fa-circle text-green-400 mr-1"></i>
                    <span id="onlineUsersCount">0</span> users online
                </div>
            </div>
            
            <nav class="space-y-2">
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200 active" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt mr-3"></i>
                    Dashboard
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="users">
                    <i class="fas fa-users mr-3"></i>
                    User Management
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="withdrawals">
                    <i class="fas fa-money-bill-wave mr-3"></i>
                    Withdrawals
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="deposits">
                    <i class="fas fa-coins mr-3"></i>
                    Deposits
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="game-control">
                    <i class="fas fa-gamepad mr-3"></i>
                    Game Control
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="today-bets">
                    <i class="fas fa-calendar-day mr-3"></i>
                    Today's Bets
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="giftcodes">
                    <i class="fas fa-gift mr-3"></i>
                    Gift Codes
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-white rounded-lg transition duration-200" data-tab="bets">
                    <i class="fas fa-chart-line mr-3"></i>
                    All Betting Activity
                </a>
            </nav>
            
            <div class="absolute bottom-6 left-6 right-6">
                <button id="logoutBtn" class="w-full btn-danger text-white py-2 rounded-lg">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content flex-1 md:ml-64 p-4 md:p-8">
            <!-- Mobile Header -->
            <div class="md:hidden bg-gray-800 rounded-xl p-4 mb-6 flex justify-between items-center">
                <button id="mobileMenuBtn" class="text-white">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <h1 class="text-xl font-bold gradient-text" id="mobilePageTitle">Dashboard</h1>
                <div class="text-sm text-gray-400">
                    <i class="fas fa-user mr-1"></i>
                    <span id="mobileAdminName">Admin</span>
                </div>
            </div>

            <!-- Desktop Header -->
            <div class="hidden md:block bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700">
                <div class="flex justify-between items-center">
                    <h1 class="text-3xl font-bold gradient-text">
                        <span id="pageTitle">Dashboard</span>
                    </h1>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-400">
                            <i class="fas fa-clock mr-1"></i>
                            <span id="currentTime"></span>
                        </div>
                        <div class="text-sm text-gray-400">
                            <i class="fas fa-user mr-1"></i>
                            <span id="adminName">Admin</span>
                        </div>
                        <div class="text-sm text-green-400">
                            <i class="fas fa-circle mr-1"></i>
                            <span id="desktopOnlineUsers">0</span> online
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-users text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-400">Total Users</p>
                                <p class="text-2xl font-bold text-white" id="totalUsers">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-wallet text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-400">Total Balance</p>
                                <p class="text-2xl font-bold text-white" id="totalBalance">₹0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                <i class="fas fa-clock text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-400">Pending Withdrawals</p>
                                <p class="text-2xl font-bold text-white" id="pendingWithdrawals">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card rounded-xl p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                <i class="fas fa-chart-line text-2xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-400">Today's Bets</p>
                                <p class="text-2xl font-bold text-white" id="todaysBets">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Recent Deposits -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">
                            <i class="fas fa-plus-circle text-green-400 mr-2"></i>
                            Recent Deposits
                        </h3>
                        <div id="recentDeposits" class="space-y-3">
                            <!-- Recent deposits will be loaded here -->
                        </div>
                    </div>

                    <!-- Recent Withdrawals -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">
                            <i class="fas fa-minus-circle text-red-400 mr-2"></i>
                            Recent Withdrawals
                        </h3>
                        <div id="recentWithdrawals" class="space-y-3">
                            <!-- Recent withdrawals will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">User Activity</h3>
                        <div style="height: 300px;">
                            <canvas id="userActivityChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Betting Statistics</h3>
                        <div style="height: 300px;">
                            <canvas id="bettingChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="usersTab" class="tab-content hidden">
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                        <h3 class="text-lg font-semibold text-white">User Management</h3>
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto">
                            <input type="text" id="userSearch" placeholder="Search users..." class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                            <button id="refreshUsers" class="btn-primary text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Name</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Phone</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Balance</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Total Bets</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Join Date</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Withdrawals Tab -->
            <div id="withdrawalsTab" class="tab-content hidden">
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                        <h3 class="text-lg font-semibold text-white">Withdrawal Requests</h3>
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto">
                            <select id="withdrawalStatusFilter" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button id="refreshWithdrawals" class="btn-primary text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Date</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Player</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Phone</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">UPI ID</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Status</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawalsTableBody">
                                <!-- Withdrawals will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Deposits Tab -->
            <div id="depositsTab" class="tab-content hidden">
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                        <h3 class="text-lg font-semibold text-white">Deposit History</h3>
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto">
                            <input type="date" id="depositDateFilter" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                            <button id="refreshDeposits" class="btn-primary text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Date</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Player</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Phone</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">UTR Number</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Status</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Time</th>
                                </tr>
                            </thead>
                            <tbody id="depositsTableBody">
                                <!-- Deposits will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Game Control Tab -->
            <div id="game-controlTab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Current Game Status -->
                    <div class="game-control-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">
                            <i class="fas fa-gamepad mr-2"></i>Current Game Status
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300">Current Period:</span>
                                <span class="font-bold text-red-400" id="currentPeriod">Loading...</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300">Time Left:</span>
                                <span class="font-bold text-yellow-400" id="timeLeft">Loading...</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300">Active Bets:</span>
                                <span class="font-bold text-green-400" id="activeBets">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300">Control Mode:</span>
                                <span class="font-bold text-blue-400" id="controlMode">AUTO</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Manual Result Control -->
                    <div class="game-control-card rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">
                            <i class="fas fa-dice mr-2"></i>Manual Result Control
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Next Result (0-9)</label>
                                <select id="nextResult" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
                                    <option value="">Auto (Random)</option>
                                    <option value="0">0 (Violet)</option>
                                    <option value="1">1 (Green)</option>
                                    <option value="2">2 (Red)</option>
                                    <option value="3">3 (Green)</option>
                                    <option value="4">4 (Red)</option>
                                    <option value="5">5 (Violet)</option>
                                    <option value="6">6 (Red)</option>
                                    <option value="7">7 (Green)</option>
                                    <option value="8">8 (Red)</option>
                                    <option value="9">9 (Green)</option>
                                </select>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button id="setResult" class="flex-1 btn-primary text-white py-2 rounded-lg">
                                    <i class="fas fa-cog mr-2"></i>Set Result
                                </button>
                                <button id="resetAuto" class="flex-1 btn-success text-white py-2 rounded-lg">
                                    <i class="fas fa-random mr-2"></i>Reset Auto
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Results -->
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold text-white mb-4">Recent Results</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Period</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Result</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Color</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Size</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Time</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Bets</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <!-- Results will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Today's Bets Tab -->
            <div id="today-betsTab" class="tab-content hidden">
                <!-- Today's Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="stat-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-white" id="todayTotalBets">0</div>
                        <div class="text-sm text-gray-400">Total Bets</div>
                    </div>
                    <div class="stat-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-green-400" id="todayTotalAmount">₹0</div>
                        <div class="text-sm text-gray-400">Total Amount</div>
                    </div>
                    <div class="stat-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-red-400" id="todayWinAmount">₹0</div>
                        <div class="text-sm text-gray-400">Win Amount</div>
                    </div>
                    <div class="stat-card rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold text-blue-400" id="todayProfit">₹0</div>
                        <div class="text-sm text-gray-400">Profit</div>
                    </div>
                </div>

                <!-- Betting Analysis -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Bet Type Distribution -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Bet Type Distribution</h3>
                        <div style="height: 300px;">
                            <canvas id="betTypeChart"></canvas>
                        </div>
                    </div>

                    <!-- Hourly Betting Activity -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Hourly Activity</h3>
                        <div style="height: 300px;">
                            <canvas id="hourlyActivityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Today's Detailed Bets -->
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                        <h3 class="text-lg font-semibold text-white">Today's Detailed Bets</h3>
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto">
                            <select id="todayBetStatusFilter" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="win">Won</option>
                                <option value="loss">Lost</option>
                            </select>
                            <select id="todayBetTypeFilter" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                                <option value="">All Types</option>
                                <option value="color">Color</option>
                                <option value="number">Number</option>
                                <option value="size">Size</option>
                            </select>
                            <button id="refreshTodayBets" class="btn-primary text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Period</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Player</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Bet Details</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Status</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Win Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Time</th>
                                </tr>
                            </thead>
                            <tbody id="todayBetsTableBody">
                                <!-- Today's bets will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Gift Codes Tab -->
            <div id="giftcodesTab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Generate Gift Code -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Generate Gift Code</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Code Name</label>
                                <input type="text" id="giftCodeName" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter code name">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Amount (₹)</label>
                                <input type="number" id="giftAmount" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter amount" min="1">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Expiry Days</label>
                                <input type="number" id="giftExpiry" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter days" value="30">
                            </div>
                            
                            <button id="generateGiftCode" class="w-full btn-success text-white py-2 rounded-lg">
                                <i class="fas fa-gift mr-2"></i>Generate Code
                            </button>
                        </div>
                    </div>
                    
                    <!-- Gift Code Stats -->
                    <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-4">Gift Code Statistics</h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="text-gray-300">Active Codes:</span>
                                <span class="font-semibold text-white" id="activeCodes">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">Used Codes:</span>
                                <span class="font-semibold text-white" id="usedCodes">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">Total Value:</span>
                                <span class="font-semibold text-white" id="totalGiftValue">₹0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-300">Redeemed Value:</span>
                                <span class="font-semibold text-white" id="redeemedGiftValue">₹0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gift Codes List -->
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 space-y-4 md:space-y-0">
                        <h3 class="text-lg font-semibold text-white">Gift Codes</h3>
                        <button id="refreshGiftCodes" class="btn-primary text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Code</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Status</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Used By</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Created</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Expiry</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="giftCodesTableBody">
                                <!-- Gift codes will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- All Bets Tab -->
            <div id="betsTab" class="tab-content hidden">
                <div class="bg-gray-800 rounded-xl p-4 md:p-6 border border-gray-700">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                        <h3 class="text-lg font-semibold text-white">All Betting Activity</h3>
                        <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 w-full md:w-auto">
                            <select id="betStatusFilter" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="win">Won</option>
                                <option value="loss">Lost</option>
                            </select>
                            <input type="text" id="betPlayerSearch" placeholder="Search player..." class="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white w-full md:w-auto">
                            <button id="refreshBets" class="btn-primary text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3 px-4 text-gray-300">Period</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Player</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Bet Details</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Status</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Win Amount</th>
                                    <th class="text-left py-3 px-4 text-gray-300">Date</th>
                                </tr>
                            </thead>
                            <tbody id="betsTableBody">
                                <!-- Bets will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Balance Modal -->
    <div id="balanceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700">
                <h3 class="text-lg font-semibold text-white mb-4">Adjust Balance</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Player</label>
                        <input type="text" id="balancePlayerName" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" readonly>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Current Balance</label>
                        <input type="text" id="currentBalance" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" readonly>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Action</label>
                        <select id="balanceAction" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
                            <option value="add">Add Money</option>
                            <option value="subtract">Subtract Money</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Amount (₹)</label>
                        <input type="number" id="balanceAmount" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Enter amount" min="1">
                    </div>
                </div>
                
                <div class="flex space-x-4 mt-6">
                    <button id="cancelBalance" class="flex-1 border border-gray-600 text-gray-300 py-2 rounded-lg hover:bg-gray-700">Cancel</button>
                    <button id="updateBalance" class="flex-1 btn-primary text-white py-2 rounded-lg">Update Balance</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'dashboard';
        let selectedUserPhone = null;
        let isLoggedIn = false;
        let currentAdmin = null;
        let userActivityChartInstance = null;
        let bettingChartInstance = null;
        let betTypeChartInstance = null;
        let hourlyActivityChartInstance = null;
        let gameTimer = null;
        let onlineUsersCount = 0;

        // Data storage keys
        const STORAGE_KEYS = {
            users: 'wavewin_users',
            withdrawals: 'wavewin_withdrawals',
            deposits: 'wavewin_deposits',
            giftCodes: 'wavewin_gift_codes',
            bets: 'wavewin_bets',
            results: 'wavewin_game_results',
            adminControls: 'wavewin_admin_controls',
            userSessions: 'wavewin_user_sessions'
        };

        // Admin credentials
        const ADMIN_CREDENTIALS = {
            '9934406008': 'admin123'
        };

        // Enhanced Data Management
        class DataManager {
            static setData(key, data) {
                try {
                    const timestamp = Date.now();
                    localStorage.setItem(key, JSON.stringify({ data, timestamp }));
                    // Trigger cross-tab communication
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: key,
                        newValue: localStorage.getItem(key)
                    }));
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            }

            static getData(key) {
                try {
                    const item = localStorage.getItem(key);
                    if (!item) return null;
                    const parsed = JSON.parse(item);
                    return parsed.data;
                } catch (error) {
                    console.error('Error loading data:', error);
                    return null;
                }
            }

            static getAllUsers() {
                const users = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('wavewin_user_')) {
                        const userData = this.getData(key);
                        if (userData) {
                            users.push(userData);
                        }
                    }
                }
                return users;
            }

            static getUserByPhone(phone) {
                return this.getData('wavewin_user_' + phone);
            }

            static updateUser(phone, updates) {
                const user = this.getUserByPhone(phone);
                if (user) {
                    Object.assign(user, updates);
                    this.setData('wavewin_user_' + phone, user);
                    
                    // Also update in users collection
                    const users = this.getData(STORAGE_KEYS.users) || {};
                    users[phone] = user;
                    this.setData(STORAGE_KEYS.users, users);
                }
            }

            static getOnlineUsers() {
                const sessions = this.getData(STORAGE_KEYS.userSessions) || {};
                const now = Date.now();
                const activeThreshold = 60000; // 1 minute
                
                return Object.values(sessions).filter(session => 
                    session.isActive && (now - session.lastSeen) < activeThreshold
                ).length;
            }

            static createDemoData() {
                // Create demo users if none exist
                const users = this.getAllUsers();
                if (users.length === 0) {
                    const demoUsers = [
                        { 
                            name: 'John Doe', 
                            phone: '9876543210', 
                            balance: 1500, 
                            password: 'demo123',
                            totalBets: 45,
                            totalWins: 23,
                            joinDate: new Date('2024-01-15').toISOString()
                        },
                        { 
                            name: 'Jane Smith', 
                            phone: '9876543211', 
                            balance: 2300, 
                            password: 'demo123',
                            totalBets: 67,
                            totalWins: 34,
                            joinDate: new Date('2024-02-20').toISOString()
                        },
                        { 
                            name: 'Mike Johnson', 
                            phone: '9876543212', 
                            balance: 850, 
                            password: 'demo123',
                            totalBets: 28,
                            totalWins: 12,
                            joinDate: new Date('2024-03-10').toISOString()
                        }
                    ];

                    demoUsers.forEach(user => {
                        this.setData('wavewin_user_' + user.phone, user);
                    });
                }

                // Create demo withdrawals
                const withdrawals = this.getData(STORAGE_KEYS.withdrawals) || [];
                if (withdrawals.length === 0) {
                    const demoWithdrawals = [
                        {
                            id: 'w1',
                            name: 'John Doe',
                            phone: '9876543210',
                            amount: 500,
                            upi: 'john@paytm',
                            status: 'pending',
                            date: new Date().toLocaleDateString(),
                            time: new Date().toLocaleTimeString()
                        },
                        {
                            id: 'w2',
                            name: 'Jane Smith',
                            phone: '9876543211',
                            amount: 1000,
                            upi: 'jane@gpay',
                            status: 'approved',
                            date: new Date().toLocaleDateString(),
                            time: new Date().toLocaleTimeString()
                        }
                    ];
                    this.setData(STORAGE_KEYS.withdrawals, demoWithdrawals);
                }

                // Create demo deposits
                const deposits = this.getData(STORAGE_KEYS.deposits) || [];
                if (deposits.length === 0) {
                    const demoDeposits = [
                        {
                            id: 'd1',
                            name: 'Mike Johnson',
                            phone: '9876543212',
                            amount: 2000,
                            utr: 'UTR123456789',
                            status: 'completed',
                            date: new Date().toLocaleDateString(),
                            time: new Date().toLocaleTimeString()
                        },
                        {
                            id: 'd2',
                            name: 'Sarah Wilson',
                            phone: '9876543213',
                            amount: 1500,
                            utr: 'UTR987654321',
                            status: 'completed',
                            date: new Date().toLocaleDateString(),
                            time: new Date().toLocaleTimeString()
                        }
                    ];
                    this.setData(STORAGE_KEYS.deposits, demoDeposits);
                }

                // Create demo bets
                const bets = this.getData(STORAGE_KEYS.bets) || [];
                if (bets.length === 0) {
                    const demoBets = [
                        {
                            id: 'b1',
                            period: this.generatePeriod(),
                            playerName: 'John Doe',
                            phone: '9876543210',
                            type: 'color',
                            value: 'red',
                            amount: 100,
                            multiplier: 1.96,
                            status: 'win',
                            winAmount: 196,
                            date: new Date().toISOString(),
                            result: 2,
                            resultColor: 'red'
                        },
                        {
                            id: 'b2',
                            period: this.generatePeriod(),
                            playerName: 'Jane Smith',
                            phone: '9876543211',
                            type: 'number',
                            value: 5,
                            amount: 200,
                            multiplier: 8.9,
                            status: 'loss',
                            winAmount: 0,
                            date: new Date().toISOString(),
                            result: 3,
                            resultColor: 'green'
                        }
                    ];
                    this.setData(STORAGE_KEYS.bets, demoBets);
                }

                // Create demo results
                const results = this.getData(STORAGE_KEYS.results) || [];
                if (results.length === 0) {
                    const demoResults = [
                        {
                            period: this.generatePeriod() - 1,
                            number: 5,
                            color: 'violet',
                            size: 'big',
                            time: new Date().toLocaleTimeString(),
                            timestamp: Date.now() - 30000
                        },
                        {
                            period: this.generatePeriod() - 2,
                            number: 2,
                            color: 'red',
                            size: 'small',
                            time: new Date().toLocaleTimeString(),
                            timestamp: Date.now() - 60000
                        }
                    ];
                    this.setData(STORAGE_KEYS.results, demoResults);
                }

                // Create demo gift codes
                const giftCodes = this.getData(STORAGE_KEYS.giftCodes) || {};
                if (Object.keys(giftCodes).length === 0) {
                    const demoCodes = {
                        'WELCOME100': {
                            name: 'Welcome Bonus',
                            amount: 100,
                            expiry: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                            created: new Date().toISOString(),
                            used: false,
                            usedBy: null
                        },
                        'NEWUSER50': {
                            name: 'New User Bonus',
                            amount: 50,
                            expiry: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                            created: new Date().toISOString(),
                            used: true,
                            usedBy: '9876543210'
                        }
                    };
                    this.setData(STORAGE_KEYS.giftCodes, demoCodes);
                }
            }

            static generatePeriod() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();
                const totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
                const roundNumber = Math.floor(totalSeconds / 30) + 1;
                return parseInt(`${year}${month}${day}${String(roundNumber).padStart(3, '0')}`);
            }

            static getTimeLeft() {
                const now = new Date();
                const seconds = now.getSeconds();
                return 30 - (seconds % 30);
            }
        }

        // Notification System
        class NotificationManager {
            static show(message, type = 'success') {
                const notification = document.getElementById('notification');
                const notificationContent = document.getElementById('notificationContent');
                const notificationText = document.getElementById('notificationText');
                
                const styles = {
                    success: 'bg-green-500 text-white',
                    error: 'bg-red-500 text-white',
                    warning: 'bg-yellow-500 text-black',
                    info: 'bg-blue-500 text-white'
                };
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };

                notificationContent.className = `px-6 py-3 rounded-lg shadow-lg ${styles[type]}`;
                notificationContent.querySelector('i').className = `${icons[type]} mr-2`;
                notificationText.textContent = message;
                notification.classList.remove('hidden');

                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            }

            static success(message) {
                this.show(message, 'success');
            }

            static error(message) {
                this.show(message, 'error');
            }

            static warning(message) {
                this.show(message, 'warning');
            }

            static info(message) {
                this.show(message, 'info');
            }
        }

        // Mobile menu handling
        function setupMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');

            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('show');
            });

            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
            });

            // Close menu when clicking nav items on mobile
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth < 768) {
                        sidebar.classList.remove('open');
                        overlay.classList.remove('show');
                    }
                });
            });
        }

        // Initialize
        function init() {
            DataManager.createDemoData();
            setupEventListeners();
            setupMobileMenu();
            updateTime();
            updateOnlineUsersCount();
            setInterval(updateTime, 1000);
            setInterval(updateOnlineUsersCount, 5000);
            
            // Check if already logged in
            const savedAdmin = localStorage.getItem('wavewin_admin_session');
            if (savedAdmin) {
                currentAdmin = JSON.parse(savedAdmin);
                showDashboard();
            }
        }

        // Update time
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString();
            }
        }

        // Update online users count
        function updateOnlineUsersCount() {
            onlineUsersCount = DataManager.getOnlineUsers();
            const onlineCountElement = document.getElementById('onlineUsersCount');
            const desktopOnlineElement = document.getElementById('desktopOnlineUsers');
            
            if (onlineCountElement) {
                onlineCountElement.textContent = onlineUsersCount;
            }
            if (desktopOnlineElement) {
                desktopOnlineElement.textContent = onlineUsersCount;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('adminPhone').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchTab(item.dataset.tab);
                });
            });

            // Balance modal
            document.getElementById('cancelBalance').addEventListener('click', () => {
                document.getElementById('balanceModal').classList.add('hidden');
            });
            document.getElementById('updateBalance').addEventListener('click', handleBalanceUpdate);

            // Game control
            document.getElementById('setResult').addEventListener('click', setNextResult);
            document.getElementById('resetAuto').addEventListener('click', resetToAuto);

            // Gift codes
            document.getElementById('generateGiftCode').addEventListener('click', generateGiftCode);

            // Refresh buttons
            document.getElementById('refreshUsers').addEventListener('click', loadUsers);
            document.getElementById('refreshWithdrawals').addEventListener('click', loadWithdrawals);
            document.getElementById('refreshDeposits').addEventListener('click', loadDeposits);
            document.getElementById('refreshGiftCodes').addEventListener('click', loadGiftCodes);
            document.getElementById('refreshBets').addEventListener('click', loadBets);
            document.getElementById('refreshTodayBets').addEventListener('click', loadTodayBets);

            // Search and filters
            document.getElementById('userSearch').addEventListener('input', filterUsers);
            document.getElementById('betStatusFilter').addEventListener('change', filterBets);
            document.getElementById('betPlayerSearch').addEventListener('input', filterBets);
            document.getElementById('withdrawalStatusFilter').addEventListener('change', filterWithdrawals);
            document.getElementById('depositDateFilter').addEventListener('change', filterDeposits);
            document.getElementById('todayBetStatusFilter').addEventListener('change', filterTodayBets);
            document.getElementById('todayBetTypeFilter').addEventListener('change', filterTodayBets);
        }

        // Handle login
        function handleLogin() {
            const phone = document.getElementById('adminPhone').value;
            const password = document.getElementById('adminPassword').value;
            const errorElement = document.getElementById('loginError');

            if (!phone || !password) {
                errorElement.textContent = 'Please enter phone and password';
                errorElement.classList.remove('hidden');
                return;
            }

            if (ADMIN_CREDENTIALS[phone] === password) {
                currentAdmin = { phone, name: 'Admin' };
                localStorage.setItem('wavewin_admin_session', JSON.stringify(currentAdmin));
                
                errorElement.classList.add('hidden');
                showDashboard();
                NotificationManager.success('Successfully logged in as admin');
            } else {
                errorElement.textContent = 'Invalid admin credentials';
                errorElement.classList.remove('hidden');
            }
        }

        // Handle logout
        function handleLogout() {
            localStorage.removeItem('wavewin_admin_session');
            currentAdmin = null;
            
            // Stop game timer
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            
            // Destroy chart instances
            if (userActivityChartInstance) {
                userActivityChartInstance.destroy();
                userActivityChartInstance = null;
            }
            if (bettingChartInstance) {
                bettingChartInstance.destroy();
                bettingChartInstance = null;
            }
            if (betTypeChartInstance) {
                betTypeChartInstance.destroy();
                betTypeChartInstance = null;
            }
            if (hourlyActivityChartInstance) {
                hourlyActivityChartInstance.destroy();
                hourlyActivityChartInstance = null;
            }
            
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            
            // Clear form
            document.getElementById('adminPhone').value = '';
            document.getElementById('adminPassword').value = '';
            
            NotificationManager.success('Logged out successfully');
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            
            if (currentAdmin) {
                document.getElementById('adminName').textContent = currentAdmin.name;
                document.getElementById('mobileAdminName').textContent = currentAdmin.name;
            }
            
            loadDashboardData();
            startGameTimer();
        }

        // Start game timer
        function startGameTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
            }
            
            gameTimer = setInterval(() => {
                updateGameStatus();
            }, 1000);
        }

        // Update game status
        function updateGameStatus() {
            const currentPeriod = DataManager.generatePeriod();
            const timeLeft = DataManager.getTimeLeft();
            
            document.getElementById('currentPeriod').textContent = currentPeriod;
            
            const mins = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const secs = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timeLeft').textContent = `${mins}:${secs}`;
            
            // Update active bets count
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            const activeBets = bets.filter(b => b.status === 'pending').length;
            document.getElementById('activeBets').textContent = activeBets;
            
            // Update control mode
            const adminControls = DataManager.getData(STORAGE_KEYS.adminControls) || {};
            const controlMode = adminControls.nextResult !== undefined ? 'MANUAL' : 'AUTO';
            document.getElementById('controlMode').textContent = controlMode;
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === tab) {
                    item.classList.add('active');
                }
            });

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tab + 'Tab').classList.remove('hidden');

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                users: 'User Management',
                withdrawals: 'Withdrawal Management',
                deposits: 'Deposit History',
                'game-control': 'Game Control',
                'today-bets': 'Today\'s Bets',
                giftcodes: 'Gift Code Management',
                bets: 'All Betting Activity'
            };
            const title = titles[tab] || 'Dashboard';
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('mobilePageTitle').textContent = title;

            // Load tab-specific data
            switch(tab) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'withdrawals':
                    loadWithdrawals();
                    break;
                case 'deposits':
                    loadDeposits();
                    break;
                case 'game-control':
                    loadGameControl();
                    break;
                case 'today-bets':
                    loadTodayBets();
                    break;
                case 'giftcodes':
                    loadGiftCodes();
                    break;
                case 'bets':
                    loadBets();
                    break;
            }
        }

        // Load dashboard data
        function loadDashboardData() {
            const users = DataManager.getAllUsers();
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            const deposits = DataManager.getData(STORAGE_KEYS.deposits) || [];
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];

            // Update stats
            document.getElementById('totalUsers').textContent = users.length;
            
            const totalBalance = users.reduce((sum, user) => sum + (user.balance || 0), 0);
            document.getElementById('totalBalance').textContent = `₹${totalBalance.toFixed(2)}`;
            
            const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending').length;
            document.getElementById('pendingWithdrawals').textContent = pendingWithdrawals;
            
            const today = new Date().toDateString();
            const todaysBets = bets.filter(b => new Date(b.date).toDateString() === today).length;
            document.getElementById('todaysBets').textContent = todaysBets;

            // Load recent activity
            loadRecentActivity();
            
            // Load charts
            loadCharts();
        }

        // Load recent activity
        function loadRecentActivity() {
            const deposits = DataManager.getData(STORAGE_KEYS.deposits) || [];
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            
            // Recent deposits
            const recentDeposits = deposits.slice(0, 5);
            const recentDepositsContainer = document.getElementById('recentDeposits');
            recentDepositsContainer.innerHTML = '';
            
            if (recentDeposits.length === 0) {
                recentDepositsContainer.innerHTML = '<div class="text-gray-400 text-center py-4">No recent deposits</div>';
            } else {
                recentDeposits.forEach(deposit => {
                    const depositDiv = document.createElement('div');
                    depositDiv.className = 'transaction-card p-3 rounded-lg';
                    depositDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-semibold text-white">${deposit.name}</div>
                                <div class="text-sm text-gray-400">${deposit.date}</div>
                            </div>
                            <div class="text-green-400 font-semibold">+₹${deposit.amount}</div>
                        </div>
                    `;
                    recentDepositsContainer.appendChild(depositDiv);
                });
            }
            
            // Recent withdrawals
            const recentWithdrawals = withdrawals.slice(0, 5);
            const recentWithdrawalsContainer = document.getElementById('recentWithdrawals');
            recentWithdrawalsContainer.innerHTML = '';
            
            if (recentWithdrawals.length === 0) {
                recentWithdrawalsContainer.innerHTML = '<div class="text-gray-400 text-center py-4">No recent withdrawals</div>';
            } else {
                recentWithdrawals.forEach(withdrawal => {
                    const withdrawalDiv = document.createElement('div');
                    withdrawalDiv.className = 'withdrawal-card p-3 rounded-lg';
                    withdrawalDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-semibold text-white">${withdrawal.name}</div>
                                <div class="text-sm text-gray-400">${withdrawal.date}</div>
                            </div>
                            <div class="text-red-400 font-semibold">-₹${withdrawal.amount}</div>
                        </div>
                    `;
                    recentWithdrawalsContainer.appendChild(withdrawalDiv);
                });
            }
        }

        // Load charts
        function loadCharts() {
            // Destroy existing chart instances
            if (userActivityChartInstance) {
                userActivityChartInstance.destroy();
            }
            if (bettingChartInstance) {
                bettingChartInstance.destroy();
            }

            // User Activity Chart
            const userCtx = document.getElementById('userActivityChart');
            if (userCtx) {
                userActivityChartInstance = new Chart(userCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Active Users',
                            data: [12, 19, 15, 25, 22, 18, 30],
                            borderColor: '#e60000',
                            backgroundColor: 'rgba(230, 0, 0, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff'
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: '#fff'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                });
            }

            // Betting Chart
            const bettingCtx = document.getElementById('bettingChart');
            if (bettingCtx) {
                bettingChartInstance = new Chart(bettingCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Red', 'Green', 'Violet', 'Numbers', 'Big/Small'],
                        datasets: [{
                            data: [30, 25, 15, 20, 10],
                            backgroundColor: [
                                '#e60000',
                                '#10b981',
                                '#8b5cf6',
                                '#f59e0b',
                                '#3b82f6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Load users
        function loadUsers() {
            const users = DataManager.getAllUsers();
            displayUsers(users);
        }

        // Display users
        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white">${user.name}</td>
                    <td class="py-3 px-4 text-white">${user.phone}</td>
                    <td class="py-3 px-4 text-white">₹${(user.balance || 0).toFixed(2)}</td>
                    <td class="py-3 px-4 text-white">${user.totalBets || 0}</td>
                    <td class="py-3 px-4 text-white">${user.joinDate ? new Date(user.joinDate).toLocaleDateString() : 'N/A'}</td>
                    <td class="py-3 px-4">
                        <button class="btn-primary text-white px-3 py-1 rounded text-sm" onclick="openBalanceModal('${user.phone}', '${user.name}', ${user.balance || 0})">
                            <i class="fas fa-wallet mr-1"></i>Balance
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Filter users
        function filterUsers() {
            const search = document.getElementById('userSearch').value.toLowerCase();
            const users = DataManager.getAllUsers();
            const filtered = users.filter(user => 
                user.name.toLowerCase().includes(search) || 
                user.phone.includes(search)
            );
            displayUsers(filtered);
        }

        // Open balance modal
        function openBalanceModal(phone, name, balance) {
            selectedUserPhone = phone;
            document.getElementById('balancePlayerName').value = name;
            document.getElementById('currentBalance').value = `₹${balance.toFixed(2)}`;
            document.getElementById('balanceAmount').value = '';
            document.getElementById('balanceModal').classList.remove('hidden');
        }

        // Handle balance update
        function handleBalanceUpdate() {
            const action = document.getElementById('balanceAction').value;
            const amount = parseFloat(document.getElementById('balanceAmount').value);
            
            if (!amount || amount <= 0) {
                NotificationManager.error('Please enter a valid amount');
                return;
            }

            const user = DataManager.getUserByPhone(selectedUserPhone);
            if (!user) {
                NotificationManager.error('User not found');
                return;
            }

            const increment = action === 'add' ? amount : -amount;
            const newBalance = Math.max(0, user.balance + increment);
            
            DataManager.updateUser(selectedUserPhone, { balance: newBalance });
            
            document.getElementById('balanceModal').classList.add('hidden');
            NotificationManager.success(`Balance ${action === 'add' ? 'added' : 'subtracted'} successfully`);
            loadUsers();
            loadDashboardData();
        }

        // Load withdrawals
        function loadWithdrawals() {
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            displayWithdrawals(withdrawals);
        }

        // Display withdrawals
        function displayWithdrawals(withdrawals) {
            const tbody = document.getElementById('withdrawalsTableBody');
            tbody.innerHTML = '';

            withdrawals.forEach(withdrawal => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                const statusClass = withdrawal.status === 'pending' ? 'status-pending' : 
                                  withdrawal.status === 'approved' ? 'status-approved' : 'status-rejected';
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white">${withdrawal.date}</td>
                    <td class="py-3 px-4 text-white">${withdrawal.name}</td>
                    <td class="py-3 px-4 text-white">${withdrawal.phone}</td>
                    <td class="py-3 px-4 text-white">₹${withdrawal.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-white">${withdrawal.upi}</td>
                    <td class="py-3 px-4">
                        <span class="${statusClass} px-2 py-1 rounded-full text-xs">${withdrawal.status.toUpperCase()}</span>
                    </td>
                    <td class="py-3 px-4">
                        ${withdrawal.status === 'pending' ? `
                            <button class="btn-success text-white px-2 py-1 rounded text-xs mr-1" onclick="approveWithdrawal('${withdrawal.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-danger text-white px-2 py-1 rounded text-xs" onclick="rejectWithdrawal('${withdrawal.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                        ` : '-'}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Filter withdrawals
        function filterWithdrawals() {
            const status = document.getElementById('withdrawalStatusFilter').value;
            const allWithdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            const filtered = status ? allWithdrawals.filter(w => w.status === status) : allWithdrawals;
            displayWithdrawals(filtered);
        }

        // Approve withdrawal
        function approveWithdrawal(withdrawalId) {
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            
            if (withdrawal) {
                withdrawal.status = 'approved';
                DataManager.setData(STORAGE_KEYS.withdrawals, withdrawals);
                
                NotificationManager.success('Withdrawal approved successfully');
                loadWithdrawals();
                loadDashboardData();
            }
        }

        // Reject withdrawal
        function rejectWithdrawal(withdrawalId) {
            const withdrawals = DataManager.getData(STORAGE_KEYS.withdrawals) || [];
            const withdrawal = withdrawals.find(w => w.id === withdrawalId);
            
            if (withdrawal) {
                withdrawal.status = 'rejected';
                DataManager.setData(STORAGE_KEYS.withdrawals, withdrawals);
                
                // Return money to user
                const user = DataManager.getUserByPhone(withdrawal.phone);
                if (user) {
                    DataManager.updateUser(withdrawal.phone, { 
                        balance: user.balance + withdrawal.amount 
                    });
                }
                
                NotificationManager.success('Withdrawal rejected and amount refunded');
                loadWithdrawals();
                loadDashboardData();
            }
        }

        // Load deposits
        function loadDeposits() {
            const deposits = DataManager.getData(STORAGE_KEYS.deposits) || [];
            displayDeposits(deposits);
        }

        // Display deposits
        function displayDeposits(deposits) {
            const tbody = document.getElementById('depositsTableBody');
            tbody.innerHTML = '';

            deposits.forEach(deposit => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white">${deposit.date}</td>
                    <td class="py-3 px-4 text-white">${deposit.name}</td>
                    <td class="py-3 px-4 text-white">${deposit.phone || 'N/A'}</td>
                    <td class="py-3 px-4 text-white">₹${deposit.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-white">${deposit.utr}</td>
                    <td class="py-3 px-4">
                        <span class="status-completed px-2 py-1 rounded-full text-xs">COMPLETED</span>
                    </td>
                    <td class="py-3 px-4 text-white">${deposit.time || 'N/A'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Filter deposits
        function filterDeposits() {
            const dateFilter = document.getElementById('depositDateFilter').value;
            const allDeposits = DataManager.getData(STORAGE_KEYS.deposits) || [];
            
            let filtered = allDeposits;
            if (dateFilter) {
                const filterDate = new Date(dateFilter).toLocaleDateString();
                filtered = allDeposits.filter(d => d.date === filterDate);
            }
            
            displayDeposits(filtered);
        }

        // Load game control
        function loadGameControl() {
            loadGameResults();
        }

        // Load game results
        function loadGameResults() {
            const results = DataManager.getData(STORAGE_KEYS.results) || [];
            displayGameResults(results);
        }

        // Display game results
        function displayGameResults(results) {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';

            results.slice(0, 10).forEach(result => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                const colorBackground = getColorBackground(result.color);
                
                // Get bet count for this period
                const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
                const periodBets = bets.filter(b => b.period === result.period);
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white">${result.period}</td>
                    <td class="py-3 px-4">
                        <span class="font-bold text-lg text-white">${result.number}</span>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs text-white" style="background-color: ${colorBackground}">
                            ${result.color.toUpperCase()}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs ${result.size === 'big' ? 'bg-red-100 text-red-800' : 'bg-orange-100 text-orange-800'}">
                            ${result.size.toUpperCase()}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-white">${result.time || 'N/A'}</td>
                    <td class="py-3 px-4 text-white">${periodBets.length}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Get color background
        function getColorBackground(color) {
            switch(color) {
                case 'red': return '#e60000';
                case 'green': return '#10b981';
                case 'violet': return '#8b5cf6';
                default: return '#6b7280';
            }
        }

        // Set next result
        function setNextResult() {
            const nextResult = document.getElementById('nextResult').value;
            
            if (nextResult === '') {
                // Reset to auto
                DataManager.setData(STORAGE_KEYS.adminControls, {});
                NotificationManager.success('Game reset to auto mode');
            } else {
                // Set manual result
                DataManager.setData(STORAGE_KEYS.adminControls, {
                    nextResult: parseInt(nextResult),
                    timestamp: Date.now()
                });
                NotificationManager.success(`Next result set to ${nextResult}`);
            }
        }

        // Reset to auto
        function resetToAuto() {
            document.getElementById('nextResult').value = '';
            DataManager.setData(STORAGE_KEYS.adminControls, {});
            NotificationManager.success('Game reset to auto mode');
        }

        // Load today's bets
        function loadTodayBets() {
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            const today = new Date().toDateString();
            const todayBets = bets.filter(b => new Date(b.date).toDateString() === today);
            
            // Update stats
            const totalBets = todayBets.length;
            const totalAmount = todayBets.reduce((sum, bet) => sum + bet.amount, 0);
            const winAmount = todayBets.reduce((sum, bet) => sum + (bet.winAmount || 0), 0);
            const profit = totalAmount - winAmount;
            
            document.getElementById('todayTotalBets').textContent = totalBets;
            document.getElementById('todayTotalAmount').textContent = `₹${totalAmount.toFixed(2)}`;
            document.getElementById('todayWinAmount').textContent = `₹${winAmount.toFixed(2)}`;
            document.getElementById('todayProfit').textContent = `₹${profit.toFixed(2)}`;
            
            // Load charts
            loadTodayCharts(todayBets);
            
            // Display bets
            displayTodayBets(todayBets);
        }

        // Load today's charts
        function loadTodayCharts(todayBets) {
            // Destroy existing chart instances
            if (betTypeChartInstance) {
                betTypeChartInstance.destroy();
            }
            if (hourlyActivityChartInstance) {
                hourlyActivityChartInstance.destroy();
            }

            // Bet Type Distribution Chart
            const betTypeCtx = document.getElementById('betTypeChart');
            if (betTypeCtx) {
                const betTypes = todayBets.reduce((acc, bet) => {
                    const key = bet.type;
                    acc[key] = (acc[key] || 0) + 1;
                    return acc;
                }, {});
                
                betTypeChartInstance = new Chart(betTypeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(betTypes),
                        datasets: [{
                            data: Object.values(betTypes),
                            backgroundColor: [
                                '#e60000',
                                '#10b981',
                                '#8b5cf6',
                                '#f59e0b',
                                '#3b82f6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                });
            }

            // Hourly Activity Chart
            const hourlyCtx = document.getElementById('hourlyActivityChart');
            if (hourlyCtx) {
                const hourlyData = new Array(24).fill(0);
                todayBets.forEach(bet => {
                    const hour = new Date(bet.date).getHours();
                    hourlyData[hour]++;
                });
                
                hourlyActivityChartInstance = new Chart(hourlyCtx, {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'Bets',
                            data: hourlyData,
                            backgroundColor: '#e60000',
                            borderColor: '#ff3333',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff'
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: '#fff'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Display today's bets
        function displayTodayBets(bets) {
            const tbody = document.getElementById('todayBetsTableBody');
            tbody.innerHTML = '';

            bets.forEach(bet => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                const statusClass = bet.status === 'pending' ? 'status-pending' : 
                                  bet.status === 'win' ? 'status-approved' : 'status-rejected';
                
                // Create bet details display
                let betDetails = '';
                if (bet.type === 'color') {
                    betDetails = `<span class="bet-type-${bet.value} px-2 py-1 rounded text-xs">${bet.value.toUpperCase()}</span>`;
                } else if (bet.type === 'number') {
                    betDetails = `<span class="bet-type-number px-2 py-1 rounded text-xs">NUMBER ${bet.value}</span>`;
                } else if (bet.type === 'size') {
                    betDetails = `<span class="bet-type-size px-2 py-1 rounded text-xs">${bet.value.toUpperCase()}</span>`;
                }
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white">${bet.period}</td>
                    <td class="py-3 px-4 text-white">${bet.playerName}</td>
                    <td class="py-3 px-4">${betDetails}</td>
                    <td class="py-3 px-4 text-white">₹${bet.amount.toFixed(2)}</td>
                    <td class="py-3 px-4">
                        <span class="${statusClass} px-2 py-1 rounded-full text-xs">${bet.status.toUpperCase()}</span>
                    </td>
                    <td class="py-3 px-4 text-white">₹${(bet.winAmount || 0).toFixed(2)}</td>
                    <td class="py-3 px-4 text-white">${new Date(bet.date).toLocaleTimeString()}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Filter today's bets
        function filterTodayBets() {
            const statusFilter = document.getElementById('todayBetStatusFilter').value;
            const typeFilter = document.getElementById('todayBetTypeFilter').value;
            
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            const today = new Date().toDateString();
            let todayBets = bets.filter(b => new Date(b.date).toDateString() === today);
            
            if (statusFilter) {
                todayBets = todayBets.filter(b => b.status === statusFilter);
            }
            
            if (typeFilter) {
                todayBets = todayBets.filter(b => b.type === typeFilter);
            }
            
            displayTodayBets(todayBets);
        }

        // Generate gift code
        function generateGiftCode() {
            const name = document.getElementById('giftCodeName').value.trim();
            const amount = parseFloat(document.getElementById('giftAmount').value);
            const expiry = parseInt(document.getElementById('giftExpiry').value);
            
            if (!name || !amount || amount <= 0) {
                NotificationManager.error('Please enter valid code name and amount');
                return;
            }

            const code = name.toUpperCase().replace(/\s+/g, '');
            const giftCodes = DataManager.getData(STORAGE_KEYS.giftCodes) || {};
            
            if (giftCodes[code]) {
                NotificationManager.error('Gift code already exists');
                return;
            }

            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + expiry);
            
            giftCodes[code] = {
                name: name,
                amount: amount,
                expiry: expiryDate.toISOString(),
                created: new Date().toISOString(),
                used: false,
                usedBy: null
            };
            
            DataManager.setData(STORAGE_KEYS.giftCodes, giftCodes);
            
            // Clear form
            document.getElementById('giftCodeName').value = '';
            document.getElementById('giftAmount').value = '';
            document.getElementById('giftExpiry').value = '30';
            
            NotificationManager.success(`Gift code "${code}" created successfully`);
            loadGiftCodes();
        }

        // Load gift codes
        function loadGiftCodes() {
            const giftCodes = DataManager.getData(STORAGE_KEYS.giftCodes) || {};
            const codes = Object.entries(giftCodes).map(([code, data]) => ({
                code,
                ...data
            }));
            
            displayGiftCodes(codes);
            updateGiftCodeStats(codes);
        }

        // Display gift codes
        function displayGiftCodes(codes) {
            const tbody = document.getElementById('giftCodesTableBody');
            tbody.innerHTML = '';

            codes.forEach(giftCode => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                const statusClass = giftCode.used ? 'status-rejected' : 'status-approved';
                const statusText = giftCode.used ? 'USED' : 'ACTIVE';
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white font-mono">${giftCode.code}</td>
                    <td class="py-3 px-4 text-white">₹${giftCode.amount.toFixed(2)}</td>
                    <td class="py-3 px-4">
                        <span class="${statusClass} px-2 py-1 rounded-full text-xs">${statusText}</span>
                    </td>
                    <td class="py-3 px-4 text-white">${giftCode.usedBy || '-'}</td>
                    <td class="py-3 px-4 text-white">${new Date(giftCode.created).toLocaleDateString()}</td>
                    <td class="py-3 px-4 text-white">${new Date(giftCode.expiry).toLocaleDateString()}</td>
                    <td class="py-3 px-4">
                        ${!giftCode.used ? `
                            <button class="btn-danger text-white px-2 py-1 rounded text-xs" onclick="deactivateGiftCode('${giftCode.code}')">
                                <i class="fas fa-ban"></i>
                            </button>
                        ` : '-'}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Update gift code stats
        function updateGiftCodeStats(codes) {
            const activeCodes = codes.filter(c => !c.used).length;
            const usedCodes = codes.filter(c => c.used).length;
            const totalValue = codes.filter(c => !c.used).reduce((sum, c) => sum + c.amount, 0);
            const redeemedValue = codes.filter(c => c.used).reduce((sum, c) => sum + c.amount, 0);
            
            document.getElementById('activeCodes').textContent = activeCodes;
            document.getElementById('usedCodes').textContent = usedCodes;
            document.getElementById('totalGiftValue').textContent = `₹${totalValue.toFixed(2)}`;
            document.getElementById('redeemedGiftValue').textContent = `₹${redeemedValue.toFixed(2)}`;
        }

        // Deactivate gift code
        function deactivateGiftCode(code) {
            const giftCodes = DataManager.getData(STORAGE_KEYS.giftCodes) || {};
            if (giftCodes[code]) {
                giftCodes[code].used = true;
                giftCodes[code].usedBy = 'Admin (Deactivated)';
                DataManager.setData(STORAGE_KEYS.giftCodes, giftCodes);
                
                NotificationManager.success('Gift code deactivated');
                loadGiftCodes();
            }
        }

        // Load bets
        function loadBets() {
            const bets = DataManager.getData(STORAGE_KEYS.bets) || [];
            displayBets(bets);
        }

        // Display bets
        function displayBets(bets) {
            const tbody = document.getElementById('betsTableBody');
            tbody.innerHTML = '';

            bets.slice(0, 100).forEach(bet => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-600 hover:bg-gray-700';
                
                const statusClass = bet.status === 'pending' ? 'status-pending' : 
                                  bet.status === 'win' ? 'status-approved' : 'status-rejected';
                
                // Create bet details display
                let betDetails = '';
                if (bet.type === 'color') {
                    betDetails = `<span class="bet-type-${bet.value} px-2 py-1 rounded text-xs">${bet.value.toUpperCase()}</span>`;
                } else if (bet.type === 'number') {
                    betDetails = `<span class="bet-type-number px-2 py-1 rounded text-xs">NUMBER ${bet.value}</span>`;
                } else if (bet.type === 'size') {
                    betDetails = `<span class="bet-type-size px-2 py-1 rounded text-xs">${bet.value.toUpperCase()}</span>`;
                }
                
                row.innerHTML = `
                    <td class="py-3 px-4 text-white">${bet.period}</td>
                    <td class="py-3 px-4 text-white">${bet.playerName}</td>
                    <td class="py-3 px-4">${betDetails}</td>
                    <td class="py-3 px-4 text-white">₹${bet.amount.toFixed(2)}</td>
                    <td class="py-3 px-4">
                        <span class="${statusClass} px-2 py-1 rounded-full text-xs">${bet.status.toUpperCase()}</span>
                    </td>
                    <td class="py-3 px-4 text-white">₹${(bet.winAmount || 0).toFixed(2)}</td>
                    <td class="py-3 px-4 text-white">${new Date(bet.date).toLocaleDateString()}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Filter bets
        function filterBets() {
            const statusFilter = document.getElementById('betStatusFilter').value;
            const playerSearch = document.getElementById('betPlayerSearch').value.toLowerCase();
            
            const allBets = DataManager.getData(STORAGE_KEYS.bets) || [];
            let filtered = allBets;
            
            if (statusFilter) {
                filtered = filtered.filter(bet => bet.status === statusFilter);
            }
            
            if (playerSearch) {
                filtered = filtered.filter(bet => 
                    bet.playerName.toLowerCase().includes(playerSearch) ||
                    bet.phone.includes(playerSearch)
                );
            }
            
            displayBets(filtered);
        }

        // Make functions global
        window.openBalanceModal = openBalanceModal;
        window.approveWithdrawal = approveWithdrawal;
        window.rejectWithdrawal = rejectWithdrawal;
        window.deactivateGiftCode = deactivateGiftCode;

        // Initialize on page load
        window.addEventListener('load', init);

        // Listen for storage changes (real-time sync)
        window.addEventListener('storage', (e) => {
            if (e.key && e.key.startsWith('wavewin_')) {
                // Update online users count
                updateOnlineUsersCount();
                
                // Refresh current tab data
                switch(currentTab) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'users':
                        loadUsers();
                        break;
                    case 'withdrawals':
                        loadWithdrawals();
                        break;
                    case 'deposits':
                        loadDeposits();
                        break;
                    case 'game-control':
                        loadGameResults();
                        break;
                    case 'today-bets':
                        loadTodayBets();
                        break;
                    case 'giftcodes':
                        loadGiftCodes();
                        break;
                    case 'bets':
                        loadBets();
                        break;
                }
            }
        });

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Page is visible, refresh data
                updateOnlineUsersCount();
                if (currentTab) {
                    switch(currentTab) {
                        case 'dashboard':
                            loadDashboardData();
                            break;
                        case 'users':
                            loadUsers();
                            break;
                        case 'withdrawals':
                            loadWithdrawals();
                            break;
                        case 'deposits':
                            loadDeposits();
                            break;
                        case 'game-control':
                            loadGameResults();
                            break;
                        case 'today-bets':
                            loadTodayBets();
                            break;
                        case 'giftcodes':
                            loadGiftCodes();
                            break;
                        case 'bets':
                            loadBets();
                            break;
                    }
                }
            }
        });
    </script>
</body>
</html>
